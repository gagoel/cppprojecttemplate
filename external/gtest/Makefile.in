##############################################################################
# GTEST Makefile - This is GTEST(googletest) Framework which we are using for
# CPP Project testing.
##############################################################################

# Variables
abs_curr_dir = $(abspath @abs_curr_dir@)
abs_project_dir = $(abspath @abs_project_dir@)
abs_build_dir = $(abspath @abs_build_dir@)
abs_install_dir = $(abspath @abs_install_dir@)
abs_src_dir = $(abs_project_dir)/src


GTEST_SRCS := $(wildcard $(abs_src_dir)/*.cc)

GTEST_HEADERS := $(wildcard $(abs_src_dir)/*.h)
GTEST_HEADERS += $(wildcard $(abs_src_dir)/include/gtest/*.h)
GTEST_HEADERS += $(wildcard $(abs_src_dir)/include/gtest/internal/*.h)

GTEST_OBJS := \
    $(abs_build_dir)/objs/gtest-all.o $(abs_build_dir)/objs/gtest_main.o

GTEST_LIBS := $(abs_build_dir)/libs/gtest.a $(abs_build_dir)/libs/gtest_main.a

GTEST_IFLAGS := \
    -I$(abs_project_dir) -I$(abs_project_dir)/include \
    -I$(abs_project_dir)/include/gtest \
    -I$(abs_project_dir)/include/gtest/internal

# Targests.
all :
	@echo "build    Build the sources and generate objects and libraries."
	@echo "clean    Delete objects and libraries generated by build."

build : generate-build-dir $(GTEST_OBJS) $(GTEST_LIBS)

clean :
	-rm -rf $(abs_build_dir)/objs
	-rm -rf $(abs_build_dir)/libs

# Local Targests.
generate-build-dir :
	@echo
	mkdir -p $(abs_build_dir)/objs
	mkdir -p $(abs_build_dir)/libs

$(abs_build_dir)/objs/gtest-all.o : $(GTEST_SRCS) $(GTEST_HEADERS)
	@echo
	$(CXX) $(GTEST_IFLAGS) -g -Wall -Wextra \
    -c $(abs_src_dir)/gtest-all.cc -o $@

$(abs_build_dir)/objs/gtest_main.o : $(GTEST_SRCS) $(GTEST_HEADERS)
	@echo
	$(CXX) $(GTEST_IFLAGS) -g -Wall -Wextra \
    -c $(abs_src_dir)/gtest_main.cc -o $@

$(abs_build_dir)/libs/gtest.a : $(abs_build_dir)/objs/gtest-all.o
	@echo
	$(AR) $(ARFLAGS) $@ $^

$(abs_build_dir)/libs/gtest_main.a : $(GTEST_OBJS)
	@echo
	$(AR) $(ARFLAGS) $@ $^
